<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <meta name="author" content="Alex Edwards">
  <meta name="author" content="Zane Billings">
  <title>SISMID R for ID Materials (2025) – Module XX: Power 2 (Unlimited Power)</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-bbe7401fe57d4b791b917637bb662036.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Module XX: Power 2 (Unlimited Power)</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
<a href="https://sph.emory.edu/profile/faculty/alex-edwards">Alex Edwards</a> 
</div>
</div>
<div class="quarto-title-author">
<div class="quarto-title-author-name">
<a href="https://wzbillings.com/">Zane Billings</a> 
</div>
</div>
</div>

</section>
<section id="learning-goals" class="slide level2">
<h2>Learning goals</h2>
<ol type="1">
<li>Compare analytic power methods with power simulations.</li>
<li>Be able to draw simulated power curves for complicated models</li>
</ol>
</section>
<section id="calculating-power" class="slide level2 scrollable">
<h2>Calculating power</h2>
<ul>
<li>For this example, we’ll use birthweight data from the <code>MASS</code> package, called <code>birthwt</code>. You can load this data using the <code>data()</code> function.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="co"># Saves a global object called birthwt</span></span>
<span id="cb1-2"><a></a><span class="fu">data</span>(birthwt, <span class="at">package =</span> <span class="st">"MASS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Let’s do a two sample <span class="math inline">\(t\)</span>-test for birth weight (<code>bwt</code>) for mothers who smoke and don’t smoke (<code>smoke</code>).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a>smoke_test <span class="ot">&lt;-</span> <span class="fu">t.test</span>(bwt <span class="sc">~</span> smoke, <span class="at">data =</span> birthwt)</span>
<span id="cb2-2"><a></a>smoke_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  bwt by smoke
t = 2.7299, df = 170.1, p-value = 0.007003
alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
95 percent confidence interval:
  78.57486 488.97860
sample estimates:
mean in group 0 mean in group 1 
       3055.696        2771.919 </code></pre>
</div>
</div>
<div class="fragment">
<ul>
<li>We can also calculate the power of this test. It takes a little bit of finagling, but it’s not too hard.</li>
<li>You could also use <a href="https://www.psychologie.hhu.de/arbeitsgruppen/allgemeine-psychologie-und-arbeitspsychologie/gpower">G Power</a> to do this, and it would probably be easier.</li>
<li>Side note: aggregate is a great way to use formulas for grouped calculations.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a>group_sample_sizes <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(bwt <span class="sc">~</span> smoke, <span class="at">data =</span> birthwt, <span class="at">FUN =</span> length)</span>
<span id="cb4-2"><a></a>group_means <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(bwt <span class="sc">~</span> smoke, <span class="at">data =</span> birthwt, <span class="at">FUN =</span> mean)</span>
<span id="cb4-3"><a></a>group_sds <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(bwt <span class="sc">~</span> smoke, <span class="at">data =</span> birthwt, <span class="at">FUN =</span> sd)</span>
<span id="cb4-4"><a></a><span class="fu">power.t.test</span>(</span>
<span id="cb4-5"><a></a>    <span class="co"># Use the average group sample size</span></span>
<span id="cb4-6"><a></a>    <span class="at">n =</span> <span class="fu">mean</span>(group_sample_sizes<span class="sc">$</span>bwt),</span>
<span id="cb4-7"><a></a>    <span class="co"># d = TRUE difference in means / so we use our post-hoc observation</span></span>
<span id="cb4-8"><a></a>    <span class="at">delta =</span> <span class="fu">diff</span>(group_means<span class="sc">$</span>bwt),</span>
<span id="cb4-9"><a></a>    <span class="co"># Pool the SD's</span></span>
<span id="cb4-10"><a></a>    <span class="at">sd =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(group_sds<span class="sc">$</span>bwt <span class="sc">^</span> <span class="dv">2</span>)),</span>
<span id="cb4-11"><a></a>    <span class="co"># Alpha level of test</span></span>
<span id="cb4-12"><a></a>    <span class="at">sig.level =</span> <span class="fl">0.05</span>,</span>
<span id="cb4-13"><a></a>    <span class="co"># Details about the test</span></span>
<span id="cb4-14"><a></a>    <span class="at">type =</span> <span class="st">"two.sample"</span>,</span>
<span id="cb4-15"><a></a>    <span class="at">alternative =</span> <span class="st">"two.sided"</span></span>
<span id="cb4-16"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample t test power calculation 

              n = 94.5
          delta = 283.7767
             sd = 707.6758
      sig.level = 0.05
          power = 0.7829694
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
<ul>
<li>We can an estimated power of about 78%. Of course this is post-hoc power so it’s basically useless.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>The G Power calculation is actually a bit more flexible.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="../images/gpower.png"></p>
<figcaption>From G Power where I typed the numbers in.</figcaption>
</figure>
</div>
<ul>
<li>The estimate is a bit different because of how G Power deals with unequal sample sizes between groups.</li>
</ul>
</div>
</section>
<section id="the-real-power-of-power" class="slide level2">
<h2>The real power of power</h2>
<ul>
<li>Power is much more useful when it isn’t <strong>post-hoc</strong>. That is, we should use power to plan our studies, rather than calculate the power after we do a test.</li>
<li>The most common application of power is <em>sample size estimation.</em></li>
</ul>
<div class="fragment">
<ul>
<li>If we want to do a t-test between two groups, we can calculate the sample size we need to achieve a specific power and alpha level for a test, assuming some underlying effect size and variability.</li>
<li>For a study that requires an unpaired t-test, let’s calculate the required sample size to achieve typical targets of <span class="math inline">\(\alpha = 0.05\)</span> and <span class="math inline">\(1 - \beta = 0.8\)</span>. For this example we’ll assume that our effect is standardized, so a clinically meaningful effect size is <span class="math inline">\(0.1\)</span>. We’ll assume for this example that the SD is <span class="math inline">\(0.25\)</span>.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Hint: you need to specify different arguments in <code>power.t.test()</code> this time.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a><span class="fu">power.t.test</span>(,</span>
<span id="cb6-2"><a></a>    <span class="at">delta =</span> ...,</span>
<span id="cb6-3"><a></a>    <span class="at">sd =</span> ...,</span>
<span id="cb6-4"><a></a>    <span class="at">sig.level =</span> ...,</span>
<span id="cb6-5"><a></a>    <span class="at">power =</span> ...,</span>
<span id="cb6-6"><a></a>    <span class="co"># Details about the test</span></span>
<span id="cb6-7"><a></a>    <span class="at">type =</span> <span class="st">"two.sample"</span>,</span>
<span id="cb6-8"><a></a>    <span class="at">alternative =</span> <span class="st">"two.sided"</span></span>
<span id="cb6-9"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment">
<ul>
<li>Solution: we need about 100 people in each group, so 200 total.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a><span class="fu">power.t.test</span>(,</span>
<span id="cb7-2"><a></a>    <span class="at">delta =</span> <span class="fl">0.1</span>,</span>
<span id="cb7-3"><a></a>    <span class="at">sd =</span> <span class="fl">0.25</span>,</span>
<span id="cb7-4"><a></a>    <span class="at">sig.level =</span> <span class="fl">0.05</span>,</span>
<span id="cb7-5"><a></a>    <span class="at">power =</span> <span class="fl">0.80</span>,</span>
<span id="cb7-6"><a></a>    <span class="co"># Details about the test</span></span>
<span id="cb7-7"><a></a>    <span class="at">type =</span> <span class="st">"two.sample"</span>,</span>
<span id="cb7-8"><a></a>    <span class="at">alternative =</span> <span class="st">"two.sided"</span></span>
<span id="cb7-9"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample t test power calculation 

              n = 99.08057
          delta = 0.1
             sd = 0.25
      sig.level = 0.05
          power = 0.8
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
</div>
<div class="fragment">
<ul>
<li>What if we don’t know the effect size or standard deviation?</li>
</ul>
</div>
</section>
<section id="power-curves" class="slide level2 scrollable">
<h2>Power curves</h2>
<ul>
<li>We can <em>often</em> get a good idea about the SD from the literature or from knowledge about how our assay/measurement works, so we’ll ignore that for now (it is harder for observational studies than for experiments).</li>
<li>But in general we have no idea what the effect size (difference in means) should be before we do the study. So how do we get the power or sample size?</li>
</ul>
<div class="fragment">
<ul>
<li>We can calculate the required sample size to achieve multiple different effect sizes. For the <code>birthwt</code> example, let’s pretend we didn’t run our study yet, but we know that the pooled sd should be around 700. Let’s calculate the sample size needed to achieve 80% power at multiple effect sizes.</li>
<li>In real life, maybe we can get this magical 700 number from previous studies or preliminary data.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>We can use the tools we’ve learned to get many different sample size calculations.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a>effect_sizes <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">500</span>, <span class="dv">10</span>)</span>
<span id="cb9-2"><a></a>sample_size_calc <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb9-3"><a></a>    effect_sizes,</span>
<span id="cb9-4"><a></a>    \(d) <span class="fu">power.t.test</span>(<span class="at">delta =</span> d, <span class="at">sd =</span> <span class="dv">700</span>, <span class="at">sig.level =</span> <span class="fl">0.05</span>, <span class="at">power =</span> <span class="fl">0.80</span>)</span>
<span id="cb9-5"><a></a>)</span>
<span id="cb9-6"><a></a><span class="fu">str</span>(sample_size_calc, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 50
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"
 $ :List of 8
  ..- attr(*, "class")= chr "power.htest"</code></pre>
</div>
</div>
</div>
<div class="fragment">
<ul>
<li>But how do we get the sample size out of each power object thing? Fortunately <code>power.t.test()</code> returns an S3 object of class <code>power.htest</code>, and the documentation tells us how to get the quantities we want.</li>
<li>We also want to round the estimate up to the nearest whole number and (optionally, but I prefer this) multiply by two for the total sample size.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>sample_size <span class="ot">&lt;-</span> <span class="fu">sapply</span>(sample_size_calc, \(x) <span class="fu">ceiling</span>(x<span class="sc">$</span>n) <span class="sc">*</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment">
<ul>
<li>We can now generate a “power curve”, a plot of the (log) sample size needed vs.&nbsp;the effect size.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a><span class="fu">plot</span>(</span>
<span id="cb12-2"><a></a>    effect_sizes,</span>
<span id="cb12-3"><a></a>    <span class="fu">log10</span>(sample_size),</span>
<span id="cb12-4"><a></a>    <span class="at">xlab =</span> <span class="st">"Effect size to detect at alpha = 0.05, power = 0.8"</span>,</span>
<span id="cb12-5"><a></a>    <span class="at">ylab =</span> <span class="st">"Log10 sample size needed"</span>,</span>
<span id="cb12-6"><a></a>    <span class="at">type =</span> <span class="st">"l"</span></span>
<span id="cb12-7"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="ModuleXX-Power-Simulation_files/figure-revealjs/unnamed-chunk-8-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="you-try-it-power-contours" class="slide level2 scrollable">
<h2>You try it! Power contours</h2>
<ul>
<li>If we’re willing to do a little bit more wrangling, we can also do this for multiple variances.</li>
<li>Here’s some code to help you get started, and then you can try to calculate the sample sizes yourself. First, make a grid of all the effect size and variance combinations we want to try.</li>
<li>Note that the more values of delta and SD you want to try, the grid can become huge really quickly which could take a long time to run.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a>power_variables <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb13-2"><a></a>    <span class="at">delta =</span> effect_sizes,</span>
<span id="cb13-3"><a></a>    <span class="at">sd =</span> <span class="fu">seq</span>(<span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">100</span>)</span>
<span id="cb13-4"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<ul>
<li>Now because they are in a grid, you can do a 1-dimensional loop or <code>lapply()</code>, instead of having to do a nested one, just iterate over the number of rows in the grid.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a>power_sim_sd <span class="ot">&lt;-</span></span>
<span id="cb14-2"><a></a>    <span class="fu">lapply</span>(</span>
<span id="cb14-3"><a></a>        <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(power_variables),</span>
<span id="cb14-4"><a></a>        \(i) <span class="fu">power.t.test</span>(</span>
<span id="cb14-5"><a></a>            ...</span>
<span id="cb14-6"><a></a>        )</span>
<span id="cb14-7"><a></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment">
<ul>
<li>My solution:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a>power_sim_sd <span class="ot">&lt;-</span></span>
<span id="cb15-2"><a></a>    <span class="fu">lapply</span>(</span>
<span id="cb15-3"><a></a>        <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(power_variables),</span>
<span id="cb15-4"><a></a>        \(i) <span class="fu">power.t.test</span>(</span>
<span id="cb15-5"><a></a>            <span class="at">delta =</span> power_variables[i, <span class="st">"delta"</span>],</span>
<span id="cb15-6"><a></a>            <span class="at">sd =</span> power_variables[i, <span class="st">"sd"</span>],</span>
<span id="cb15-7"><a></a>            <span class="at">sig.level =</span> <span class="fl">0.05</span>, <span class="at">power =</span> <span class="fl">0.80</span></span>
<span id="cb15-8"><a></a>        )</span>
<span id="cb15-9"><a></a>    )</span>
<span id="cb15-10"><a></a></span>
<span id="cb15-11"><a></a>power_variables<span class="sc">$</span>sample_size <span class="ot">&lt;-</span> <span class="fu">sapply</span>(power_sim_sd, \(x) <span class="fu">ceiling</span>(x<span class="sc">$</span>n) <span class="sc">*</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment">
<ul>
<li>There are two main ways people will try to plot these curves. One is by plotting a different colored curve for each SD.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a><span class="fu">plot</span>(</span>
<span id="cb16-2"><a></a>    <span class="cn">NULL</span>, <span class="cn">NULL</span>,</span>
<span id="cb16-3"><a></a>    <span class="at">xlim =</span> <span class="fu">range</span>(effect_sizes),</span>
<span id="cb16-4"><a></a>    <span class="at">ylim =</span> <span class="fu">range</span>(<span class="fu">log10</span>(power_variables<span class="sc">$</span>sample_size)),</span>
<span id="cb16-5"><a></a>    <span class="at">xlab =</span> <span class="st">"Effect size to detect at alpha = 0.05, power = 0.8"</span>,</span>
<span id="cb16-6"><a></a>    <span class="at">ylab =</span> <span class="st">"Log10 sample size needed"</span>,</span>
<span id="cb16-7"><a></a>    <span class="at">type =</span> <span class="st">"l"</span></span>
<span id="cb16-8"><a></a>)</span>
<span id="cb16-9"><a></a></span>
<span id="cb16-10"><a></a>variance_levels <span class="ot">&lt;-</span> <span class="fu">unique</span>(power_variables<span class="sc">$</span>sd)</span>
<span id="cb16-11"><a></a>colors <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"lightblue"</span>, <span class="st">"darkblue"</span>))(<span class="fu">length</span>(variance_levels))</span>
<span id="cb16-12"><a></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(variance_levels)) {</span>
<span id="cb16-13"><a></a>    sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(power_variables, sd <span class="sc">==</span> variance_levels[[i]])</span>
<span id="cb16-14"><a></a>    <span class="fu">lines</span>(<span class="at">x =</span> sub<span class="sc">$</span>delta, <span class="at">y =</span> <span class="fu">log10</span>(sub<span class="sc">$</span>sample_size), <span class="at">col =</span> colors[[i]])</span>
<span id="cb16-15"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="ModuleXX-Power-Simulation_files/figure-revealjs/unnamed-chunk-12-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="fragment">
<ul>
<li>If you know <code>ggplot2</code>, this is way easier in <code>ggplot2</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb17-2"><a></a><span class="fu">ggplot</span>(power_variables) <span class="sc">+</span></span>
<span id="cb17-3"><a></a>    <span class="fu">aes</span>(<span class="at">x =</span> delta, <span class="at">y =</span> <span class="fu">log10</span>(sample_size), <span class="at">color =</span> sd, <span class="at">group =</span> sd) <span class="sc">+</span></span>
<span id="cb17-4"><a></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb17-5"><a></a>    <span class="fu">labs</span>(</span>
<span id="cb17-6"><a></a>    <span class="at">x =</span> <span class="st">"Effect size to detect at alpha = 0.05, power = 0.8"</span>,</span>
<span id="cb17-7"><a></a>    <span class="at">y =</span> <span class="st">"Log10 sample size needed"</span></span>
<span id="cb17-8"><a></a>    ) <span class="sc">+</span></span>
<span id="cb17-9"><a></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="ModuleXX-Power-Simulation_files/figure-revealjs/unnamed-chunk-13-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="fragment">
<ul>
<li>Mathematicians love to plot this as a “contour plot”. These are basically impossible to read but look impressive.</li>
<li>This is insanely annoying to do in base R, so I’ll only show it in <code>ggplot2</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a><span class="fu">ggplot</span>(power_variables) <span class="sc">+</span></span>
<span id="cb18-2"><a></a>    <span class="fu">aes</span>(<span class="at">x =</span> delta, <span class="at">y =</span> sd, <span class="at">z =</span> <span class="fu">log10</span>(sample_size)) <span class="sc">+</span></span>
<span id="cb18-3"><a></a>    <span class="fu">geom_contour_filled</span>() <span class="sc">+</span></span>
<span id="cb18-4"><a></a>    <span class="fu">coord_cartesian</span>(<span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb18-5"><a></a>    <span class="fu">labs</span>(</span>
<span id="cb18-6"><a></a>        <span class="at">x =</span> <span class="st">"Effect size to detect at alpha = 0.05, power = 0.8"</span>,</span>
<span id="cb18-7"><a></a>        <span class="at">y =</span> <span class="st">"Assumed pooled SD"</span>,</span>
<span id="cb18-8"><a></a>        <span class="at">fill =</span> <span class="st">"Log10 sample sized need"</span></span>
<span id="cb18-9"><a></a>    ) <span class="sc">+</span></span>
<span id="cb18-10"><a></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb18-11"><a></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="ModuleXX-Power-Simulation_files/figure-revealjs/unnamed-chunk-14-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="power-simulations" class="slide level2 scrollable">
<h2>Power simulations</h2>
<ul>
<li>Power calculations are “non-analytic” for nearly all hypothesis tests, except for very simple ones.</li>
<li>Simulation is a much more robust way to estimate power, because it works for any test.</li>
<li>As an example, we’ll first walk through simulating the power for the same t-test we just did.</li>
<li>Remember that <strong>power is the chance that a false null hypothesis will be rejected.</strong></li>
</ul>
<div class="fragment">
<ol type="1">
<li>Choose the parameters for the simulation. These include all of the TRUE parameters for the data we hope to collect, the significance level, and the number of simulations.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a>N_sims <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb19-2"><a></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb19-3"><a></a></span>
<span id="cb19-4"><a></a><span class="co"># T-test parameter</span></span>
<span id="cb19-5"><a></a><span class="co"># Number of samples</span></span>
<span id="cb19-6"><a></a>n1 <span class="ot">&lt;-</span> <span class="dv">115</span></span>
<span id="cb19-7"><a></a>n2 <span class="ot">&lt;-</span> <span class="dv">74</span></span>
<span id="cb19-8"><a></a><span class="co"># Group means</span></span>
<span id="cb19-9"><a></a>mu1 <span class="ot">&lt;-</span> <span class="dv">2500</span></span>
<span id="cb19-10"><a></a>mu2 <span class="ot">&lt;-</span> <span class="dv">2200</span></span>
<span id="cb19-11"><a></a><span class="co"># Group SD</span></span>
<span id="cb19-12"><a></a>sd1 <span class="ot">&lt;-</span> <span class="dv">750</span></span>
<span id="cb19-13"><a></a>sd2 <span class="ot">&lt;-</span> <span class="dv">650</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Now we generate <code>N_sims</code> number of datasets from a model described by the <span class="math inline">\(t\)</span>-test: that is, we draw <code>n1</code> observations from a normal distribution wiht mean <code>mu1</code> and sd <code>sd1</code>, and likewise for group 2.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a></a>simulate_one_dataset <span class="ot">&lt;-</span> <span class="cf">function</span>(n1, n2, mu1, mu2, sd1, sd2) {</span>
<span id="cb20-2"><a></a>    group1_y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n1, mu1, sd1)</span>
<span id="cb20-3"><a></a>    group2_y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n2, mu2, sd2)</span>
<span id="cb20-4"><a></a>    </span>
<span id="cb20-5"><a></a>    out <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">group1 =</span> group1_y, <span class="at">group2 =</span> group2_y)</span>
<span id="cb20-6"><a></a>    <span class="fu">return</span>(out)</span>
<span id="cb20-7"><a></a>}</span>
<span id="cb20-8"><a></a></span>
<span id="cb20-9"><a></a><span class="co"># replicate() is just a fancy way to use lapply() when the function</span></span>
<span id="cb20-10"><a></a><span class="co"># you want to repeat doesn't depend on any iteration-specific argument</span></span>
<span id="cb20-11"><a></a>simulated_data <span class="ot">&lt;-</span> <span class="fu">replicate</span>(</span>
<span id="cb20-12"><a></a>    N_sims,</span>
<span id="cb20-13"><a></a>    <span class="fu">simulate_one_dataset</span>(n1, n2, mu1, mu2, sd1, sd2),</span>
<span id="cb20-14"><a></a>    <span class="co"># Set simplify = FALSE or you get a weird array thats hard to understand</span></span>
<span id="cb20-15"><a></a>    <span class="at">simplify =</span> <span class="cn">FALSE</span></span>
<span id="cb20-16"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Now we do a (Welch’s two-sample) t-test on each simulated dataset. Note that in our true data generating process, the null hypothesis is always false by design. (<em>This is one of the times where it’s easier NOT to use a formula!</em>)</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a>simulated_t_tests <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb21-2"><a></a>    simulated_data,</span>
<span id="cb21-3"><a></a>    \(d) <span class="fu">t.test</span>(d<span class="sc">$</span>group1, d<span class="sc">$</span>group2, <span class="at">conf.level =</span> alpha)</span>
<span id="cb21-4"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Now we count the t-tests that correctly rejected the null hypothesis, i.e.&nbsp;<span class="math inline">\(p \leq \alpha\)</span>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a>simulation_p_values <span class="ot">&lt;-</span> <span class="fu">sapply</span>(simulated_t_tests, \(x) x<span class="sc">$</span>p.value)</span>
<span id="cb22-2"><a></a>rejected_h0 <span class="ot">&lt;-</span> simulation_p_values <span class="sc">&lt;=</span> alpha</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="5" type="1">
<li>Now we calculate the power of our test as the probability that a simulated test rejected H0. Note that we even compute a confidence interval for our power here, although its interpretation is a bit tricky it can tell us a range of powers that are <em>consistent with our simulation</em>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a><span class="co"># We can use this function to get the exact CI (Clopper-Pearson) for us</span></span>
<span id="cb23-2"><a></a><span class="co"># Just ignore the p-value, it doesn't make sense!!</span></span>
<span id="cb23-3"><a></a><span class="fu">binom.test</span>(<span class="fu">sum</span>(rejected_h0), N_sims)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Exact binomial test

data:  sum(rejected_h0) and N_sims
number of successes = 8260, number of trials = 10000, p-value &lt; 2.2e-16
alternative hypothesis: true probability of success is not equal to 0.5
95 percent confidence interval:
 0.8184250 0.8333847
sample estimates:
probability of success 
                 0.826 </code></pre>
</div>
</div>
<ol start="6" type="1">
<li>Interpretation: the power of our test after 10,000 replicates was about 83%, and our CI is pretty tight around this number. If this wasn’t post-hoc, we would say that the planned sample sizes achieve our goal of <span class="math inline">\(80\%\)</span> power at <span class="math inline">\(\alpha = 0.05\)</span>.</li>
</ol>
</div>
</section>
<section id="you-try-it" class="slide level2">
<h2>You try it!</h2>
<ul>
<li>More often, we want to know what sample size it takes to get 80% power for a fixed leve</li>
<li>The only way to do this by simulation is to try many sample sizes and do a simulation for each one.</li>
<li>For the t-test example (this time you can assume the sample size for the two groups is the same to make life easier), make a plot of power vs.&nbsp;sample size, using the same group means and group SDs.</li>
</ul>
<div class="fragment">
<ul>
<li>Hint: write a function that simulates the data, does the t-tests, and gets which tests are rejections. Then, <code>lapply()</code> this function over multiple values of <code>n</code> (this is easy if you assume <code>n1</code> and <code>n2</code> are equal).</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Hint: here’s an outline for my function, and the code for how I used it.</li>
<li>I returned the entire vector of TRUE/FALSE for rejections from the function, because I thought this was a convenient way to handle the data. You can do the sum() or mean() inside of the function and return a single number if you prefer that.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a>simulate_t_test_power <span class="ot">&lt;-</span> <span class="cf">function</span>(N_sim, n1, n2, mu1, mu2, sd1, sd2, <span class="at">alpha =</span> <span class="fl">0.05</span>) {</span>
<span id="cb25-2"><a></a>    simulated_data <span class="ot">&lt;-</span></span>
<span id="cb25-3"><a></a>        <span class="fu">replicate</span>(</span>
<span id="cb25-4"><a></a>            N_sims,</span>
<span id="cb25-5"><a></a>            <span class="fu">simulate_one_dataset</span>(n1, n2, mu1, mu2, sd1, sd2),</span>
<span id="cb25-6"><a></a>            <span class="at">simplify =</span> <span class="cn">FALSE</span></span>
<span id="cb25-7"><a></a>        )</span>
<span id="cb25-8"><a></a>    </span>
<span id="cb25-9"><a></a>    simulated_t_tests <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb25-10"><a></a>        simulated_data,</span>
<span id="cb25-11"><a></a>        \(d) ...</span>
<span id="cb25-12"><a></a>    )</span>
<span id="cb25-13"><a></a>    </span>
<span id="cb25-14"><a></a>    simulation_p_values <span class="ot">&lt;-</span> <span class="fu">sapply</span>(simulated_t_tests, ...)</span>
<span id="cb25-15"><a></a>    rejected_h0 <span class="ot">&lt;-</span> ...</span>
<span id="cb25-16"><a></a>    </span>
<span id="cb25-17"><a></a>    <span class="fu">return</span>(rejected_h0)</span>
<span id="cb25-18"><a></a>}</span>
<span id="cb25-19"><a></a></span>
<span id="cb25-20"><a></a>n_per_group <span class="ot">&lt;-</span> <span class="fu">seq</span>(...)</span>
<span id="cb25-21"><a></a></span>
<span id="cb25-22"><a></a>t_test_n_simulations <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb25-23"><a></a>    n_per_group,</span>
<span id="cb25-24"><a></a>    \(n) <span class="fu">simulate_t_test_power</span>(</span>
<span id="cb25-25"><a></a>        <span class="dv">1000</span>,</span>
<span id="cb25-26"><a></a>        n, n,</span>
<span id="cb25-27"><a></a>        mu1, mu2, sd1, sd2</span>
<span id="cb25-28"><a></a>    )</span>
<span id="cb25-29"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment">
<ul>
<li>Hint: after I ran this function, here’s how I got the power for each sample size.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a><span class="fu">colMeans</span>(t_test_n_simulations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment">
<ul>
<li>Here’s my solution.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a>simulate_t_test_power <span class="ot">&lt;-</span> <span class="cf">function</span>(N_sim, n1, n2, mu1, mu2, sd1, sd2, <span class="at">alpha =</span> <span class="fl">0.05</span>) {</span>
<span id="cb27-2"><a></a>    simulated_data <span class="ot">&lt;-</span></span>
<span id="cb27-3"><a></a>        <span class="fu">replicate</span>(</span>
<span id="cb27-4"><a></a>            N_sims,</span>
<span id="cb27-5"><a></a>            <span class="fu">simulate_one_dataset</span>(n1, n2, mu1, mu2, sd1, sd2),</span>
<span id="cb27-6"><a></a>            <span class="at">simplify =</span> <span class="cn">FALSE</span></span>
<span id="cb27-7"><a></a>        )</span>
<span id="cb27-8"><a></a>    </span>
<span id="cb27-9"><a></a>    simulated_t_tests <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb27-10"><a></a>        simulated_data,</span>
<span id="cb27-11"><a></a>        \(d) <span class="fu">t.test</span>(d<span class="sc">$</span>group1, d<span class="sc">$</span>group2, <span class="at">conf.level =</span> alpha)</span>
<span id="cb27-12"><a></a>    )</span>
<span id="cb27-13"><a></a>    </span>
<span id="cb27-14"><a></a>    simulation_p_values <span class="ot">&lt;-</span> <span class="fu">sapply</span>(simulated_t_tests, \(x) x<span class="sc">$</span>p.value)</span>
<span id="cb27-15"><a></a>    rejected_h0 <span class="ot">&lt;-</span> simulation_p_values <span class="sc">&lt;=</span> alpha</span>
<span id="cb27-16"><a></a>    </span>
<span id="cb27-17"><a></a>    <span class="fu">return</span>(rejected_h0)</span>
<span id="cb27-18"><a></a>}</span>
<span id="cb27-19"><a></a></span>
<span id="cb27-20"><a></a><span class="co"># You can do less of these</span></span>
<span id="cb27-21"><a></a><span class="co"># and make N_sim lower</span></span>
<span id="cb27-22"><a></a><span class="co"># if this takes too long</span></span>
<span id="cb27-23"><a></a>n_per_group <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">25</span>, <span class="dv">250</span>, <span class="dv">25</span>)</span>
<span id="cb27-24"><a></a></span>
<span id="cb27-25"><a></a><span class="fu">set.seed</span>(<span class="dv">102</span>)</span>
<span id="cb27-26"><a></a>t_test_n_simulations <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb27-27"><a></a>    n_per_group,</span>
<span id="cb27-28"><a></a>    \(n) <span class="fu">simulate_t_test_power</span>(</span>
<span id="cb27-29"><a></a>        <span class="dv">1000</span>,</span>
<span id="cb27-30"><a></a>        n, n,</span>
<span id="cb27-31"><a></a>        mu1, mu2, sd1, sd2</span>
<span id="cb27-32"><a></a>    )</span>
<span id="cb27-33"><a></a>)</span>
<span id="cb27-34"><a></a></span>
<span id="cb27-35"><a></a><span class="co"># sapply() gives us a matrix that we can easily apply() on to get summaries</span></span>
<span id="cb27-36"><a></a><span class="co"># or use colMeans() cause its super fast and easy</span></span>
<span id="cb27-37"><a></a>res <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(t_test_n_simulations)</span>
<span id="cb27-38"><a></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.3197 0.5670 0.7407 0.8495 0.9164 0.9576 0.9769 0.9880 0.9942 0.9976</code></pre>
</div>
</div>
</div>
<div class="fragment">
<ul>
<li>By looking at these results, it’s clear where we can do a second simulation to hone in on a better sample size – between the 3rd and 4th levement of <code>n_per_group</code> we get to our target.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a></a><span class="co"># Interpolate between those two numbers, but don't repeat them</span></span>
<span id="cb29-2"><a></a><span class="co"># cause we already did those sims!</span></span>
<span id="cb29-3"><a></a>n_per_group2 <span class="ot">&lt;-</span> <span class="fu">seq</span>(n_per_group[<span class="dv">3</span>], n_per_group[<span class="dv">4</span>], <span class="dv">1</span>)</span>
<span id="cb29-4"><a></a>n_per_group2_trim <span class="ot">&lt;-</span> n_per_group2[<span class="dv">2</span><span class="sc">:</span>(<span class="fu">length</span>(n_per_group2) <span class="sc">-</span> <span class="dv">1</span>)]</span>
<span id="cb29-5"><a></a></span>
<span id="cb29-6"><a></a><span class="fu">set.seed</span>(<span class="dv">103</span>)</span>
<span id="cb29-7"><a></a>t_test_n_simulations2 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb29-8"><a></a>    n_per_group2_trim,</span>
<span id="cb29-9"><a></a>    \(n) <span class="fu">simulate_t_test_power</span>(</span>
<span id="cb29-10"><a></a>        <span class="dv">1000</span>,</span>
<span id="cb29-11"><a></a>        n, n,</span>
<span id="cb29-12"><a></a>        mu1, mu2, sd1, sd2</span>
<span id="cb29-13"><a></a>    )</span>
<span id="cb29-14"><a></a>)</span>
<span id="cb29-15"><a></a></span>
<span id="cb29-16"><a></a><span class="co"># sapply() gives us a matrix that we can easily apply() on to get summaries</span></span>
<span id="cb29-17"><a></a><span class="co"># or use colMeans() cause its super fast and easy</span></span>
<span id="cb29-18"><a></a>res2 <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(t_test_n_simulations2)</span>
<span id="cb29-19"><a></a>res2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.7448 0.7449 0.7681 0.7615 0.7647 0.7690 0.7764 0.7819 0.7814 0.7889
[11] 0.7952 0.8072 0.8007 0.8061 0.8180 0.8135 0.8149 0.8316 0.8313 0.8361
[21] 0.8410 0.8420 0.8463 0.8508</code></pre>
</div>
</div>
</div>
<div class="fragment">
<ul>
<li>Now I’ll show you a neat trick to combine these simulations together and make a plot.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a></a>all_n <span class="ot">&lt;-</span> <span class="fu">c</span>(n_per_group, n_per_group2_trim)</span>
<span id="cb31-2"><a></a>all_res <span class="ot">&lt;-</span> <span class="fu">c</span>(res, res2)</span>
<span id="cb31-3"><a></a>sort_order <span class="ot">&lt;-</span> <span class="fu">order</span>(all_n)</span>
<span id="cb31-4"><a></a></span>
<span id="cb31-5"><a></a><span class="fu">plot</span>(</span>
<span id="cb31-6"><a></a>    all_n[sort_order], all_res[sort_order],</span>
<span id="cb31-7"><a></a>    <span class="at">type =</span> <span class="st">"l"</span>,</span>
<span id="cb31-8"><a></a>    <span class="at">xlab =</span> <span class="st">"Sample size"</span>, <span class="at">ylab =</span> <span class="st">"Power"</span></span>
<span id="cb31-9"><a></a>)</span>
<span id="cb31-10"><a></a><span class="co"># Find the smallest sample size with a power above 0.8</span></span>
<span id="cb31-11"><a></a>best_samp_size <span class="ot">&lt;-</span> <span class="fu">min</span>(all_n[all_res <span class="sc">&gt;</span> <span class="fl">0.8</span>])</span>
<span id="cb31-12"><a></a>bss_power <span class="ot">&lt;-</span> all_res[all_n <span class="sc">==</span> best_samp_size]</span>
<span id="cb31-13"><a></a></span>
<span id="cb31-14"><a></a><span class="fu">abline</span>(<span class="at">h =</span> bss_power, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb31-15"><a></a><span class="fu">abline</span>(<span class="at">v =</span> best_samp_size, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="ModuleXX-Power-Simulation_files/figure-revealjs/unnamed-chunk-24-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="setting-up-a-power-simulation-for-logistic-regression" class="slide level2">
<h2>Setting up a power simulation for logistic regression</h2>
<ul>
<li>Simulating power is a MUST when we need to use a more complex model. For example, we have to do simulation to get the power of logistic regression.</li>
<li>I’ll walk you through the data generating code and the correct p-value to check, but I’ll let you fill in the code details.</li>
</ul>
<div class="fragment">
<ul>
<li>Recall that the model we fit for logistic regression is something like this.</li>
</ul>
<p><span class="math display">\[
y_i \sim \text{Bernoulli}(p_i) \\
\text{logit}(p_i) = \beta_0 + \beta_1 x_i \\
\]</span></p>
<ul>
<li>So the things we need to assume are values for <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> and the allowed values or distribution of <span class="math inline">\(x_i\)</span>. And of course we need a sample size <span class="math inline">\(n\)</span> that we’ll vary to see how the power changes.</li>
<li>We can interpret <span class="math inline">\(\beta_0\)</span> as the log-odds of the event occurring for an individual at baseline. Let’s assume our outcome is somewhat rare, say <span class="math inline">\(10\%\)</span> of people get it. We can convert this to log-odds with some R code.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a></a><span class="co"># qlogis turns a probability into a log-odds</span></span>
<span id="cb32-2"><a></a><span class="co"># plogis turns a log-odds into a probability</span></span>
<span id="cb32-3"><a></a><span class="fu">qlogis</span>(<span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2.197225</code></pre>
</div>
</div>
</div>
<div class="fragment">
<ul>
<li>So we’ll say <span class="math inline">\(\beta_0 = -2.2\)</span>.</li>
<li>Now we need to assume values for <span class="math inline">\(x\)</span> and an effect size <span class="math inline">\(\beta_1\)</span>. For simplicity, let’s say <span class="math inline">\(x\)</span> is dichotomous, and if an individual has the exposure <span class="math inline">\(x=1\)</span>, their log-odds are <span class="math inline">\(1.5\times\)</span> the log-odds of someone with <span class="math inline">\(x=0\)</span>, which means <span class="math inline">\(\beta_1 = 1.5\)</span>.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Finally, since <span class="math inline">\(x\)</span> is dichotomous, we need a baseline prevalence of <span class="math inline">\(x\)</span>. Let’s say the prevalence of <span class="math inline">\(x\)</span> is <span class="math inline">\(40\%\)</span>, pretty common but not quite half and half.</li>
<li>So then we can sample from the model.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a></a>generate_logistic_model_data <span class="ot">&lt;-</span> <span class="cf">function</span>(n, beta_0, beta_1, exposure_prevalence) {</span>
<span id="cb34-2"><a></a>    x <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> exposure_prevalence)</span>
<span id="cb34-3"><a></a>    logit_p <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x</span>
<span id="cb34-4"><a></a>    p <span class="ot">&lt;-</span> <span class="fu">plogis</span>(logit_p)</span>
<span id="cb34-5"><a></a>    y <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> p)</span>
<span id="cb34-6"><a></a>    </span>
<span id="cb34-7"><a></a>    out <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb34-8"><a></a>    <span class="fu">return</span>(out)</span>
<span id="cb34-9"><a></a>}</span>
<span id="cb34-10"><a></a></span>
<span id="cb34-11"><a></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb34-12"><a></a>test_logistic_data <span class="ot">&lt;-</span> <span class="fu">generate_logistic_model_data</span>(<span class="dv">100</span>, <span class="sc">-</span><span class="fl">2.2</span>, <span class="fl">1.5</span>, <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment">
<ul>
<li>Now let’s walk through the test we need to do.</li>
<li>First we fit a glm.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a></a>test_logistic_fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb35-2"><a></a>    test_logistic_data<span class="sc">$</span>y <span class="sc">~</span> test_logistic_data<span class="sc">$</span>x,</span>
<span id="cb35-3"><a></a>    <span class="at">family =</span> <span class="st">"binomial"</span></span>
<span id="cb35-4"><a></a>)</span>
<span id="cb35-5"><a></a></span>
<span id="cb35-6"><a></a><span class="fu">summary</span>(test_logistic_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = test_logistic_data$y ~ test_logistic_data$x, family = "binomial")

Coefficients:
                     Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -2.7515     0.5955  -4.621 3.83e-06 ***
test_logistic_data$x   2.3461     0.6618   3.545 0.000392 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 107.855  on 99  degrees of freedom
Residual deviance:  89.998  on 98  degrees of freedom
AIC: 93.998

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<ul>
<li>From the summary output, we see that the p-value for our test of interest is <span class="math inline">\(0.000392\)</span>. How do we get that out of the test?</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>The summary of the glm is an S3 object! But it’s a different class than the glm fit.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a></a>glm_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(test_logistic_fit)</span>
<span id="cb37-2"><a></a></span>
<span id="cb37-3"><a></a><span class="co"># The coefficients are a matrix so we put in the indices that we want</span></span>
<span id="cb37-4"><a></a>glm_summary<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0003923781</code></pre>
</div>
</div>
</div>
</section>
<section id="you-try-it-finish-the-power-simulation" class="slide level2">
<h2>You try it! Finish the power simulation</h2>
<ul>
<li>Now that we’ve walked through the building blocks, finish the power simulation. Find an <span class="math inline">\(n\)</span> where the power under our assumptions about the data is between <span class="math inline">\(0.75\)</span> and <span class="math inline">\(0.85\)</span>, that range is close enough.</li>
</ul>
<div class="fragment">
<ul>
<li>Hint: this kind of power simulation is easier if you break it down into components, write a function for each component, and then put them all together.</li>
<li>I think you need three components: a data simulation function that returns a data set, a test function that returns a p-value for the given dataset (or returns accept/reject), and a function that puts those two parts together so you can repeat the whole thing.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Hint: here’s the test function.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a></a>get_exposure_slope_p_value <span class="ot">&lt;-</span> <span class="cf">function</span>(simulated_dataset) {</span>
<span id="cb39-2"><a></a>    logistic_fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb39-3"><a></a>        simulated_dataset<span class="sc">$</span>y <span class="sc">~</span> simulated_dataset<span class="sc">$</span>x,</span>
<span id="cb39-4"><a></a>        <span class="at">family =</span> <span class="st">"binomial"</span></span>
<span id="cb39-5"><a></a>    )</span>
<span id="cb39-6"><a></a>    </span>
<span id="cb39-7"><a></a>    glm_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(logistic_fit)</span>
<span id="cb39-8"><a></a>    </span>
<span id="cb39-9"><a></a>    p_value <span class="ot">&lt;-</span> glm_summary<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">4</span>]</span>
<span id="cb39-10"><a></a>    </span>
<span id="cb39-11"><a></a>    <span class="fu">return</span>(p_value)</span>
<span id="cb39-12"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment">
<ul>
<li>Hint: now you can put the two parts together and then get the rejections.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a></a>logistic_power_simulation <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb40-2"><a></a>        N_sims, n, beta_0, beta_1, exposure_prevalence, alpha</span>
<span id="cb40-3"><a></a>) {</span>
<span id="cb40-4"><a></a>    simulated_datasets <span class="ot">&lt;-</span> <span class="fu">replicate</span>(</span>
<span id="cb40-5"><a></a>        ...</span>
<span id="cb40-6"><a></a>    )</span>
<span id="cb40-7"><a></a>    </span>
<span id="cb40-8"><a></a>    simulated_p_values <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb40-9"><a></a>        ...</span>
<span id="cb40-10"><a></a>    )</span>
<span id="cb40-11"><a></a>    </span>
<span id="cb40-12"><a></a>    rejections <span class="ot">&lt;-</span> ...</span>
<span id="cb40-13"><a></a>    </span>
<span id="cb40-14"><a></a>    <span class="fu">return</span>(rejections)</span>
<span id="cb40-15"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment">
<ul>
<li>Hint: here’s my completed function.</li>
<li>Can you repeat it for multiple <code>n</code> values now?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a></a>logistic_power_simulation <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb41-2"><a></a>        N_sims, n, beta_0, beta_1, exposure_prevalence, alpha</span>
<span id="cb41-3"><a></a>) {</span>
<span id="cb41-4"><a></a>    simulated_datasets <span class="ot">&lt;-</span> <span class="fu">replicate</span>(</span>
<span id="cb41-5"><a></a>        N_sims,</span>
<span id="cb41-6"><a></a>        <span class="fu">generate_logistic_model_data</span>(n, beta_0, beta_1, exposure_prevalence),</span>
<span id="cb41-7"><a></a>        <span class="at">simplify =</span> <span class="cn">FALSE</span></span>
<span id="cb41-8"><a></a>    )</span>
<span id="cb41-9"><a></a>    </span>
<span id="cb41-10"><a></a>    simulated_p_values <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb41-11"><a></a>        simulated_datasets,</span>
<span id="cb41-12"><a></a>        get_exposure_slope_p_value</span>
<span id="cb41-13"><a></a>    )</span>
<span id="cb41-14"><a></a>    </span>
<span id="cb41-15"><a></a>    rejections <span class="ot">&lt;-</span> simulated_p_values <span class="sc">&lt;=</span> alpha</span>
<span id="cb41-16"><a></a>    </span>
<span id="cb41-17"><a></a>    <span class="fu">return</span>(rejections)</span>
<span id="cb41-18"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a></a>n_values <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">25</span>, <span class="dv">250</span>, <span class="dv">25</span>)</span>
<span id="cb42-2"><a></a></span>
<span id="cb42-3"><a></a><span class="fu">set.seed</span>(<span class="dv">110</span>)</span>
<span id="cb42-4"><a></a>logistic_sim <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb42-5"><a></a>    n_values,</span>
<span id="cb42-6"><a></a>    \(n) <span class="fu">logistic_power_simulation</span>(</span>
<span id="cb42-7"><a></a>        <span class="dv">1000</span>,</span>
<span id="cb42-8"><a></a>        n,</span>
<span id="cb42-9"><a></a>        <span class="sc">-</span><span class="fl">2.2</span>, <span class="fl">1.5</span>, <span class="fl">0.4</span>, <span class="fl">0.05</span></span>
<span id="cb42-10"><a></a>    )</span>
<span id="cb42-11"><a></a>)</span>
<span id="cb42-12"><a></a></span>
<span id="cb42-13"><a></a>logistic_sim_power <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(logistic_sim)</span>
<span id="cb42-14"><a></a></span>
<span id="cb42-15"><a></a><span class="fu">plot</span>(</span>
<span id="cb42-16"><a></a>    n_values, logistic_sim_power,</span>
<span id="cb42-17"><a></a>    <span class="at">xlab =</span> <span class="st">"Sample size"</span>, <span class="at">ylab =</span> <span class="st">"Power"</span>,</span>
<span id="cb42-18"><a></a>    <span class="at">type =</span> <span class="st">"l"</span></span>
<span id="cb42-19"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="ModuleXX-Power-Simulation_files/figure-revealjs/unnamed-chunk-32-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>If we look at the values, we see that a sample size of 100 gives us a power of about <span class="math inline">\(81\%\)</span> under these assumptions.</li>
</ul>
</div>
</section>
<section id="final-note-parametrizations" class="slide level2 incremental">
<h2>Final note: parametrizations</h2>
<ul>
<li>Notice that in the logistic regression simulation, we simulated our dataset using the exposure prevalence. If you know the exposure prevalence, that works fine.</li>
<li>If you <strong>don’t</strong> know the exposure prevalence, you can instead simulate a dataset with <code>n_exposed</code> and <code>n_unexposed</code>, or assume the sample size of the two groups has to be equal like we did for the t-test example.</li>
<li>These are basically the same, we just assumed that <code>n_exposed / n_total = 0.4</code>, but there’s lots of ways you can do the same thing.</li>
<li>In general, what matters the most for the power of a logistic regression is <strong>the number of events in each group</strong>, and you can write a simulation that takes that into account too.</li>
</ul>
</section>
<section id="summary" class="slide level2">
<h2>Summary</h2>
<ul>
<li>Power is kind of confusing, we have to make really strong assumptions to do an <em>a priori</em> power analysis. But <em>post hoc</em> power analysis doesn’t really tell us anything.</li>
<li>Calculating the power of a test directly is impossible for most tests.</li>
<li>Fortunately we can use the tools we learned in this class to do a power simulation, which can help us estimate power under various assumptions for complicated models.</li>
</ul>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    

    <script>

      // htmlwidgets need to know to resize themselves when slides are shown/hidden.

      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current

      // slide changes (different for each slide format).

      (function () {

        // dispatch for htmlwidgets

        function fireSlideEnter() {

          const event = window.document.createEvent("Event");

          event.initEvent("slideenter", true, true);

          window.document.dispatchEvent(event);

        }

    

        function fireSlideChanged(previousSlide, currentSlide) {

          fireSlideEnter();

    

          // dispatch for shiny

          if (window.jQuery) {

            if (previousSlide) {

              window.jQuery(previousSlide).trigger("hidden");

            }

            if (currentSlide) {

              window.jQuery(currentSlide).trigger("shown");

            }

          }

        }

    

        // hookup for slidy

        if (window.w3c_slidy) {

          window.w3c_slidy.add_observer(function (slide_num) {

            // slide_num starts at position 1

            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);

          });

        }

    

      })();

    </script>

    

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>