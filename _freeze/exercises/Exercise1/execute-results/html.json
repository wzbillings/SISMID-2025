{
  "hash": "103860170a1d3f8d0ff79fdadccc618d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Intermediate R Lab using QCRC Data\"\nformat: html\neditor: visual\n---\n\n\n\n\n# Introduction\n\nIn this lab, we’ll analyze the **QCRC_FINAL_Deidentified.xlsx** dataset to practice:\n\n-   Two-sample t-test\n-   Chi-square test\n-   Linear regression\n-   Logistic regression\n-   Writing `if` statements\n-   Iteration using `for` loops and `apply`\n\nLet’s get started!\n\n------------------------------------------------------------------------\n\n# Part 1 - Loading Data\n\nFirst, load the required packages and read the Excel file.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Install if not already installed \\# install.packages(\"readxl\")\n\nlibrary(readxl)\n\n# Adjust the path if needed\n\ndata <- read_excel(here::here(\"data/QCRC_FINAL_Deidentified.xlsx\"))\n\n# View first few rows\n\nhead(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 37\n  Patient_DEID Decatur_Transfer   Age Female Race           Died `30D_Mortality`\n         <dbl> <chr>            <dbl> <chr>  <chr>         <dbl>           <dbl>\n1     17205428 0                   89 Female Caucasian or…     1               1\n2     17234405 .                   73 Female African Amer…     0               0\n3     17239956 0                   53 Male   Caucasian or…     0               0\n4     17350926 .                   55 Male   African Amer…     1               1\n5     17377951 0                   66 Female African Amer…     1               1\n6     17397040 0                   78 Male   African Amer…     1               1\n# ℹ 30 more variables: `60D_Mortality` <dbl>, `Death date_deid` <chr>,\n#   ICU_LOS <dbl>, BMI <chr>, `Died in ICU` <dbl>, `Code status` <chr>,\n#   Epoprostenol <dbl>, Remdesivir_or_placebo <dbl>, Intubated <dbl>,\n#   ICU_ADMIT_DEID <dttm>, ICU_DC_DEID <dttm>, HOSPITAL_ADMIT_DEID <dttm>,\n#   HOSPITAL_DC_DEID <dttm>, `Vent LOS` <chr>, CRRT <dbl>, `CRRT days` <chr>,\n#   HD <dbl>, `HD days` <chr>, `Pressor >2 hours` <dbl>, `Pressor days` <chr>,\n#   `Absolute lymphocyte` <chr>, WBC <chr>, `D dimer` <chr>, CRP <chr>, …\n```\n\n\n:::\n\n```{.r .cell-code}\n# View variable names\n\nnames(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Patient_DEID\"                  \"Decatur_Transfer\"             \n [3] \"Age\"                           \"Female\"                       \n [5] \"Race\"                          \"Died\"                         \n [7] \"30D_Mortality\"                 \"60D_Mortality\"                \n [9] \"Death date_deid\"               \"ICU_LOS\"                      \n[11] \"BMI\"                           \"Died in ICU\"                  \n[13] \"Code status\"                   \"Epoprostenol\"                 \n[15] \"Remdesivir_or_placebo\"         \"Intubated\"                    \n[17] \"ICU_ADMIT_DEID\"                \"ICU_DC_DEID\"                  \n[19] \"HOSPITAL_ADMIT_DEID\"           \"HOSPITAL_DC_DEID\"             \n[21] \"Vent LOS\"                      \"CRRT\"                         \n[23] \"CRRT days\"                     \"HD\"                           \n[25] \"HD days\"                       \"Pressor >2 hours\"             \n[27] \"Pressor days\"                  \"Absolute lymphocyte\"          \n[29] \"WBC\"                           \"D dimer\"                      \n[31] \"CRP\"                           \"Peak troponin\"                \n[33] \"P:F ratio at ICU admission\"    \"P:F ratio at first intubation\"\n[35] \"Calculated_Cstat\"              \"First_Intubation_deid\"        \n[37] \"Last_Intubation_deid\"         \n```\n\n\n:::\n\n```{.r .cell-code}\n# Quick summary\n\nsummary(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Patient_DEID       Decatur_Transfer        Age           Female         \n Min.   : 17205428   Length:288         Min.   :19.00   Length:288        \n 1st Qu.: 19933699   Class :character   1st Qu.:55.00   Class :character  \n Median : 75429122   Mode  :character   Median :65.00   Mode  :character  \n Mean   : 64011213                      Mean   :63.47                     \n 3rd Qu.:101302250                      3rd Qu.:74.25                     \n Max.   :104729011                      Max.   :89.00                     \n     Race                Died        30D_Mortality    60D_Mortality   \n Length:288         Min.   :0.0000   Min.   :0.0000   Min.   :0.0000  \n Class :character   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.0000  \n Mode  :character   Median :0.0000   Median :0.0000   Median :0.0000  \n                    Mean   :0.3403   Mean   :0.3264   Mean   :0.3333  \n                    3rd Qu.:1.0000   3rd Qu.:1.0000   3rd Qu.:1.0000  \n                    Max.   :1.0000   Max.   :1.0000   Max.   :1.0000  \n Death date_deid       ICU_LOS           BMI             Died in ICU    \n Length:288         Min.   : 0.000   Length:288         Min.   :0.0000  \n Class :character   1st Qu.: 3.428   Class :character   1st Qu.:0.0000  \n Mode  :character   Median : 9.000   Mode  :character   Median :0.0000  \n                    Mean   :10.527                      Mean   :0.2674  \n                    3rd Qu.:15.000                      3rd Qu.:1.0000  \n                    Max.   :56.000                      Max.   :1.0000  \n Code status         Epoprostenol    Remdesivir_or_placebo   Intubated     \n Length:288         Min.   :0.0000   Min.   :0.0000        Min.   :0.0000  \n Class :character   1st Qu.:0.0000   1st Qu.:0.0000        1st Qu.:0.0000  \n Mode  :character   Median :0.0000   Median :0.0000        Median :1.0000  \n                    Mean   :0.1007   Mean   :0.1701        Mean   :0.7361  \n                    3rd Qu.:0.0000   3rd Qu.:0.0000        3rd Qu.:1.0000  \n                    Max.   :1.0000   Max.   :1.0000        Max.   :1.0000  \n ICU_ADMIT_DEID                 ICU_DC_DEID                 \n Min.   :2020-02-21 17:27:16   Min.   :2020-02-22 21:34:23  \n 1st Qu.:2020-03-29 06:25:12   1st Qu.:2020-04-04 16:43:58  \n Median :2020-04-05 21:36:22   Median :2020-04-16 00:44:00  \n Mean   :2020-04-08 21:22:42   Mean   :2020-04-17 20:43:44  \n 3rd Qu.:2020-04-18 00:48:11   3rd Qu.:2020-04-28 18:41:36  \n Max.   :2020-05-11 06:55:41   Max.   :2020-06-09 17:29:00  \n HOSPITAL_ADMIT_DEID           HOSPITAL_DC_DEID                Vent LOS        \n Min.   :2020-02-21 04:48:00   Min.   :2020-03-13 04:48:00   Length:288        \n 1st Qu.:2020-03-27 04:48:00   1st Qu.:2020-04-10 04:48:00   Class :character  \n Median :2020-04-03 04:48:00   Median :2020-04-24 04:48:00   Mode  :character  \n Mean   :2020-04-06 18:58:00   Mean   :2020-04-24 21:43:00                     \n 3rd Qu.:2020-04-16 04:48:00   3rd Qu.:2020-05-06 04:48:00                     \n Max.   :2020-05-10 04:48:00   Max.   :2020-06-09 04:48:00                     \n      CRRT         CRRT days               HD           HD days         \n Min.   :0.0000   Length:288         Min.   :0.0000   Length:288        \n 1st Qu.:0.0000   Class :character   1st Qu.:0.0000   Class :character  \n Median :0.0000   Mode  :character   Median :0.0000   Mode  :character  \n Mean   :0.2292                      Mean   :0.1354                     \n 3rd Qu.:0.0000                      3rd Qu.:0.0000                     \n Max.   :1.0000                      Max.   :1.0000                     \n Pressor >2 hours Pressor days       Absolute lymphocyte     WBC           \n Min.   :0.0000   Length:288         Length:288          Length:288        \n 1st Qu.:0.0000   Class :character   Class :character    Class :character  \n Median :1.0000   Mode  :character   Mode  :character    Mode  :character  \n Mean   :0.6354                                                            \n 3rd Qu.:1.0000                                                            \n Max.   :1.0000                                                            \n   D dimer              CRP            Peak troponin     \n Length:288         Length:288         Length:288        \n Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character  \n                                                         \n                                                         \n                                                         \n P:F ratio at ICU admission P:F ratio at first intubation Calculated_Cstat  \n Length:288                 Length:288                    Length:288        \n Class :character           Class :character              Class :character  \n Mode  :character           Mode  :character              Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n First_Intubation_deid Last_Intubation_deid\n Length:288            Length:288          \n Class :character      Class :character    \n Mode  :character      Mode  :character    \n                                           \n                                           \n                                           \n```\n\n\n:::\n:::\n\n\n\n\n# Part 2 - Two-Sample t-test\n\nSuppose we want to compare the mean Age of patients who were Intubated vs. those who were not.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert Intubated to a factor for clarity\ndata$Intubated <- factor(data$Intubated, labels = c(\"No\", \"Yes\"))\n\n# Check group means\ntapply(data$Age, data$Intubated, mean, na.rm = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      No      Yes \n65.07895 62.89151 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Run t-test\nt.test(Age ~ Intubated, data = data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWelch Two Sample t-test\n\ndata:  Age by Intubated\nt = 0.95244, df = 111.54, p-value = 0.3429\nalternative hypothesis: true difference in means between group No and group Yes is not equal to 0\n95 percent confidence interval:\n -2.363342  6.738218\nsample estimates:\n mean in group No mean in group Yes \n         65.07895          62.89151 \n```\n\n\n:::\n:::\n\n\n\n\n# Exercise\n\n-   Run the above code.\n\n-   Now insert a new code chunk below and write the code to test whether BMI differs between patients who were Intubated vs. those who were not.\n\n# Part 3 - Chi-square Test\n\nLet’s check if `CRRT` use is associated with mortality (`Died`).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert to factors\ndata$CRRT <- factor(data$CRRT, labels = c(\"No\", \"Yes\"))\ndata$Died <- factor(data$Died, labels = c(\"No\", \"Yes\"))\n\n# Create a contingency table\ntab <- table(data$CRRT, data$Died)\ntab\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     \n       No Yes\n  No  165  57\n  Yes  25  41\n```\n\n\n:::\n\n```{.r .cell-code}\n# Perform chi-square test\nchisq.test(tab)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPearson's Chi-squared test with Yates' continuity correction\n\ndata:  tab\nX-squared = 28.501, df = 1, p-value = 9.367e-08\n```\n\n\n:::\n:::\n\n\n\n\n## Exercise\n\n-   Run the test above.\n\n-   Now insert a new code chunk below and write the code to repeat the chi-square test for `Intubated` vs. `Died`.\n\n# Part 4 - Linear Regression\n\nWe’ll model `ICU_LOS` as a function of `Age`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit linear model\nlm_model <- lm(ICU_LOS ~ Age, data = data)\n\n# View results\nsummary(lm_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = ICU_LOS ~ Age, data = data)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-10.747  -6.982  -1.579   4.437  45.348 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 9.979425   2.183423   4.571 7.25e-06 ***\nAge         0.008621   0.033422   0.258    0.797    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 8.778 on 286 degrees of freedom\nMultiple R-squared:  0.0002326,\tAdjusted R-squared:  -0.003263 \nF-statistic: 0.06653 on 1 and 286 DF,  p-value: 0.7966\n```\n\n\n:::\n:::\n\n\n\n\n## Exercise\n\n-   Run the code above.\n\n-   Now, add a chuck and write the code to fit a model predicting `Vent LOS` using `BMI` adjust the analysis to account for `Age` by adding in an additional covariate.\n\n# Part 5 - Logistic Regression\n\nLet’s predict the odds of dying (`Died`) based on `Age` and `ICU_LOS`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit logistic regression (notice the family)\nlog_model <- glm(Died ~ Age + ICU_LOS, data = data, family = binomial)\n\n# View summary\nsummary(log_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = Died ~ Age + ICU_LOS, family = binomial, data = data)\n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -3.930819   0.695340  -5.653 1.58e-08 ***\nAge          0.049605   0.009818   5.052 4.36e-07 ***\nICU_LOS      0.002475   0.014708   0.168    0.866    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 369.34  on 287  degrees of freedom\nResidual deviance: 338.84  on 285  degrees of freedom\nAIC: 344.84\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n\n```{.r .cell-code}\n# View odss ratios\nexp(coef(log_model))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(Intercept)         Age     ICU_LOS \n 0.01962759  1.05085602  1.00247765 \n```\n\n\n:::\n:::\n\n\n\n\n## Exercise\n\n-   Run the model above.\n\n-   Now, insert a new chunk ande try predicting `Intubated` using `BMI` and `Age`.\n\n# Part 6 - If Statements\n\n`if` lets you run code when a condition is true.\n\nExample:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Example using the first patient\npatient_age <- data$Age[1]\n\nif (patient_age > 45) {\n  print(\"Patient is older than 45.\")\n} else {\n  print(\"Patient is 45 or younger.\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Patient is older than 45.\"\n```\n\n\n:::\n:::\n\n\n\n\nYou can also use `else if`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Example with more categories\nif (patient_age > 65) {\n  print(\"Patient is elderly.\")\n} else if (patient_age > 45) {\n  print(\"Patient is middle-aged.\")\n} else {\n  print(\"Patient is young.\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Patient is elderly.\"\n```\n\n\n:::\n:::\n\n\n\n\n## Exercise\n\n-   Write an if-else statement that tests if a patient’s age is greater than 45 and prints:\n\n    -   “Patient is older than 45.” if true\n\n    -   Otherwise prints “Patient is 45 or younger.”\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nage_value <- 72\n\nif (age_value > 65) {\n  print(\"Patient is elderly\")\n} else {\n  print(\"Patient is not elderly\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Patient is elderly\"\n```\n\n\n:::\n:::\n\n\n\n\n# Great work! You have practiced:\n\n-   Hypothesis testing\n\n-   Regression models\n\n-   Conditional logic\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}